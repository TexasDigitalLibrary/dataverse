<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:jsf="http://xmlns.jcp.org/jsf">

    <h:head>
    </h:head>

    <h:body>
        <f:metadata>
         	<f:viewParam name="userId" value="#{AuthenticationResponse.userId}"/>
            <f:viewParam name="redirectPage" value="#{LoginPage.redirectPage}"/>
        </f:metadata>
        <ui:composition template="/dataverse_template.xhtml">
            <ui:param name="pageTitle" value="#{bundle.login} - #{dataverseServiceBean.findRootDataverse().name} #{bundle.dataverse}"/>
            <ui:param name="showDataverseHeader" value="false"/>
            <ui:param name="showMessagePanel" value="#{true}"/>
            <ui:param name="loginRedirectPage" value="dataverse.xhtml"/>
            <ui:define name="body">
                <div id="login-container" class="row">
					<p>#{TwoFactorPage.getTitle(param['idpId'])}</p>
                    <div class="panel panel-default highlight col-md-12">
                        <div class="panel-body row">
							<iframe id="duo_iframe" width="620" height="330" frameborder="0"></iframe>
                        </div>
                    </div>
                </div>

				<script type="text/javascript" src="#{resource['js/Duo-Web-v2.min.js']}"></script>
				<script>
					var host = "#{TwoFactorPage.getHostname(param['idpId'])}";
					var sig_request = "#{TwoFactorPage.getToken(param['idpId'], param['username'])}";
						
					// var post_action = '/two-factor/response';
					var post_action = '/two-factor/callback.xhtml';
					
					console.log('In the javascript...');
					console.log('host: ' + host);
					console.log('sig_request: ' + sig_request);
					console.log('post_action' + post_action);
					
  					Duo.init({
    					'host': host,
    					'sig_request': sig_request,
    					'post_action': post_action,
    					'post_argument': 'code'
  					});
				</script>			
            </ui:define>
        </ui:composition>
    </h:body>
</html>